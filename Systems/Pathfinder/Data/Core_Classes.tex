% % Core Classes
\def\BarbarianBAB{g}
\def\BarbarianFort{g}
\def\BarbarianRef{p}
\def\BarbarianWill{p}
\NewCounter{BarbarianSkillRanksPerLevelCount}
\SetCounter{BarbarianSkillRanksPerLevelCount}{4}
\NewCounter{BarbarianHitDieSize}
\SetCounter{BarbarianHitDieSize}{12}
\edef\BarbarianClassSkillsList{}
\forcsvlist{\listadd{\BarbarianClassSkillsList}}{Acrobatics, Climb, Craft, HandleAnimal, Intimidate, KnowledgeNature, Perception, Ride, Survival, Swim}
\newcommand{\AddBarbarianClassFeatures}[1]{
		\AddClassFeature{Fast Movement}\AddToCounter{CharBaseSpeedCount}{10}
		\AddClassFeature{\ifthenelse{#1 > 10}{\ifthenelse{#1 > 19}{Mighty }{Greater }}{} Rage}
			\AddLimitedUse{Rage (rounds)}{\DoMath{#1 * 2 + 2 +\value{CharConModCount} + \value{CharRageRoundsCount}}}
			\NewCounter{CharRageRoundsCount}
			\newcommand{\IWouldLikeToRage}{
				\tmpBonus{AC}{-2}
				\ifthenelse{#1 > 10}{\ifthenelse{#1 > 19}{
					\tmpBonus{Con}{8}\tmpBonus{str}{8}\tmpBonus[morale]{Will}{4} %Mighty Rage
					\AddToCounter{CharRageRoundsCount}{-4}
				}{
					\tmpBonus{Con}{6}\tmpBonus{str}{6}\tmpBonus[morale]{Will}{3} %Greater Rage
					\AddToCounter{CharRageRoundsCount}{-3}
				}}{
					\tmpBonus{Con}{4}\tmpBonus{str}{4}\tmpBonus[morale]{Will}{2} %Rage
					\AddToCounter{CharRageRoundsCount}{-2}
				}
				\ifthenelse{#1 > 13}{
					\AddConditionalDefMod{+4 vs. EnChantments}
				}{}
			}
	\ifthenelse{#1 > 1}{
		\AddClassFeature{\ifthenelse{#1 > 4}{Improved }{}Uncanny Dodge}
			\ifthenelse{#1 > 4}{\AddSpecialDefense{Improved Uncanny Dodge}}{\AddSpecialDefense{Uncanny Dodge}}
		\edef\CharRagePowersList{}
		\NewCounter{CharRagePowersCount}
		\AddToCounter{CharRagePowersCount}{#1 / 2}
		\AddClassFeature{Rage Powers:\forlistloop{\\~~~~}{\CharRagePowersList}}
		\NewDocumentCommand{\AddRagePower}{m}{
			\listinsert{\CharRagePowersList}{##1}
			\AddToCounter{CharRagePowersCount}{-1}
		}
		\gappto{\RunChecks}{%
			%%CHECK RAGE POWERS
			\ifthenelse{\value{CharRagePowersCount} < 0}{
				\AddWarning{\DoMath{-\value{CharRagePowersCount}} too many rage powers}
			}{
			\ifthenelse{\value{CharRagePowersCount} > 0}{
				\AddWarning{Choose \arabic{CharRagePowersCount} more rage powers}
			}{}}
		}
	\ifthenelse{#1 > 2}{
		\AddClassFeature{Trap Sense +\DoMath{#1 / 3}}\AddConditionalDefMod{+\DoMath{#1 / 3} vs. traps}
	\ifthenelse{#1 > 6}{
		\AddClassFeature{Damage Reduction}\DoMath*{(#1 - 4) / 3}\AddDR{--}{\value{@DoMathCounter}}
	\ifthenelse{#1 > 13}{
		\AddClassFeature{Indomitable Will}
	\ifthenelse{#1 > 16}{
		\AddClassFeature{Tireless Rage}
	}{}}{}}{}}{}}{}
}

\def\BardBAB{a}
\def\BardFort{p}
\def\BardRef{g}
\def\BardWill{g}
\NewCounter{BardSkillRanksPerLevelCount}
\SetCounter{BardSkillRanksPerLevelCount}{6}
\NewCounter{BardHitDieSize}
\SetCounter{BardHitDieSize}{8}
\edef\BardClassSkillsList{}
\forcsvlist{\listadd{\BardClassSkillsList}}{Acrobatics, Appraise, Bluff, Climb, Craft, Diplomacy, Disguise, EscapeArtist, Intimidate, KnowledgeAll, Linguistics, Perception, Perform, Profession, SenseMotive, SleightOfHand, Spellcraft, Stealth, UseMagicDevice}
\newcommand{\AddBardClassFeatures}[1]{
	\edef\CharBardicPerformanceList{}
	\AddClassFeature{Bardic Performance (save DC \DoMath{10 + #1 / 2 + \value{CharChaModCount}})\forlistloop{\\~~~~}{\CharBardicPerformanceList}}
		\NewCounter{CharBardicPerformanceRoundsCount}
		\AddLimitedUse{Bardic Performance (rounds)}{\DoMath{#1 * 2 + 2 + \value{CharChaModCount} + \value{CharBardicPerformanceRoundsCount}}}
			\listadd{\CharBardicPerformanceList}{Countersong}
			\listadd{\CharBardicPerformanceList}{Fascinate}
			\listadd{\CharBardicPerformanceList}{Inspire Courage +\DoMath{(#1 + 1) / 6 + 1}}
	\AddClassFeature{Bardic Knowledge}
		\renewcommand{\do}[1]{
			\MiscBonus{##1}{#1 / 2}
		}\dolistloop{\KnowledgeSkillsList}
		\AddConditionalSkillMod{Can make Knowledge checks untrained.}
	\ifthenelse{#1 > 1}{
		\edef\CharVersatilePerformancesList{}
		\AddClassFeature{Versatile Performance\forlistloop{\\~~~~}{\CharVersatilePerformancesList}}
			\NewCounter{CharVersatilePerformancesCount}
			\SetCounter{CharVersatilePerformancesCount}{(#1 + 2) / 4}
			\NewDocumentCommand{\AddVersatilePerformance}{m}{
				\listinsert{\CharVersatilePerformancesList}{##1}
				\AddToCounter{CharVersatilePerformancesCount}{-1}
			}
			\gappto{\RunChecks}{%
				%%CHECK VERSATILE PERFORMANCES
				\ifthenelse{\value{CharVersatilePerformancesCount} < 0}{
					\AddWarning{\DoMath{-\value{CharVersatilePerformancesCount}} too many Versatile Performance Skills}
				}{
				\ifthenelse{\value{CharVersatilePerformancesCount} > 0}{
					\AddWarning{Choose \arabic{CharVersatilePerformancesCount} more Versatile Performance Skills}
				}{}}
			}
		\AddClassFeature{Well-Versed}
			\AddConditionalDefMod{+4 vs. Bardic Performance, Sonic, Language-Dependent}
	\ifthenelse{#1 > 2}{
			\listadd{\CharBardicPerformanceList}{Inspire Competence +\DoMath{(#1 + 1) / 4 + 1}}
	\ifthenelse{#1 > 4}{
		\AddClassFeature{Lore Master}
			\AddConditionalSkillMod{Can take 10 in any Knowledge Skill with ranks.}
			\AddLimitedUse{Lore Master}{\DoMath{(#1 + 1)/6}}
	\ifthenelse{#1 > 5}{
		\listadd{\CharBardicPerformanceList}{\ifthenelse{#1 > 17}{Mass }{}Suggestion}
	\ifthenelse{#1 > 7}{
			\listadd{\CharBardicPerformanceList}{Dirge of Doom}
	\ifthenelse{#1 > 8}{
		\listadd{\CharBardicPerformanceList}{Inspire Greatness}
	\ifthenelse{#1 > 9}{
		\AddClassFeature{Jack of All Trades}
			\AddConditionalSkillMod{Can use trained-only Skills as if they were trained.}
	\ifthenelse{#1 > 11}{
		\listadd{\CharBardicPerformanceList}{Soothing Performance}
	\ifthenelse{#1 > 13}{
		\listadd{\CharBardicPerformanceList}{Frightening Tune}
	\ifthenelse{#1 > 14}{
		\listadd{\CharBardicPerformanceList}{Inspire Heroics}
	\ifthenelse{#1 > 15}{
		\forlistloop{\isClassSkill}{\SkillsList}
	\ifthenelse{#1 > 18}{
		\AddConditionalSkillMod{Can take 10 on any Skill check.}
	\ifthenelse{#1 > 19}{
		\listadd{\CharBardicPerformanceList}{Deadly Performance}
	}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}
	\newcommand{\AddBardSpellcasting}[1]{
		\ifthenelse{##1 < 2}{\SetCounter{@i}{0}}{
		\ifthenelse{##1 < 4}{\SetCounter{@i}{1}}{
		\ifthenelse{##1 < 7}{\SetCounter{@i}{2}}{
		\ifthenelse{##1 < 10}{\SetCounter{@i}{3}}{
		\ifthenelse{##1 < 13}{\SetCounter{@i}{4}}{
		\ifthenelse{##1 < 16}{\SetCounter{@i}{5}}{\SetCounter{@i}{6}}}}}}}
		\newSpellcasting[\value{@i}]{Bard}{##1}{Cha}
		\AddTwoThirdsSpellcasing{##1}
	}
}

\def\ClericBAB{a}
\def\ClericFort{g}
\def\ClericRef{p}
\def\ClericWill{g}
\NewCounter{ClericSkillRanksPerLevelCount}
\SetCounter{ClericSkillRanksPerLevelCount}{2}
\NewCounter{ClericHitDieSize}
\SetCounter{ClericHitDieSize}{8}
\edef\ClericClassSkillsList{}
\forcsvlist{\listadd{\ClericClassSkillsList}}{Appraise, Craft, Diplomacy, Heal, KnowledgeArcana, KnowledgeHistory, KnowledgeNobility, KnowledgePlanes, KnowledgeReligion, Linguistics, Profession, SenseMotive, Spellcraft}
\newcommand{\AddClericClassFeatures}[1]{
	\NewCounter{CharChannelenergyusesCount}
	\SetCounter{CharChannelenergyusesCount}{3 + \value{CharChaModCount}}
	\AddLimitedUse{Channel Energy \DoMath{(#1 + 1) / 2}d6}{\arabic{CharChannelenergyusesCount}}
	\newcommand{\AddClericSpellcasting}[3]{
		\newSpellcasting[(##1 + 1) / 2]{Cleric}{##1}{wis}
		\AddPrimarySpellcasting{##1}
		\ForLoop{@i}{1}{\value{@i}<10}{
			\AddBonusSpellslots{\arabic{@i}}{1}
		}
		\AddSpellcastingSpecialization[Domain]{##2}
		\AddSpellcastingSpecialization[Domain]{##3}
	}
}

\def\DruidBAB{a}
\def\DruidFort{g}
\def\DruidRef{p}
\def\DruidWill{g}
\NewCounter{DruidSkillRanksPerLevelCount}
\SetCounter{DruidSkillRanksPerLevelCount}{4}
\NewCounter{DruidHitDieSize}
\SetCounter{DruidHitDieSize}{8}
\edef\DruidClassSkillsList{}
\forcsvlist{\listadd{\DruidClassSkillsList}}{Climb, Craft, Fly, HandleAnimal, Heal, KnowledgeGeography, KnowledgeNature, Perception, Profession, Ride, Spellcraft, Survival, Swim}
\newcommand{\AddDruidClassFeatures}[1]{
	\AddClassFeature{Nature Bond}
	\AddClassFeature{Nature Sense}\MiscBonus{KnowledgeNature}{2}\MiscBonus{Survival}{2}
	\AddClassFeature{Wild Empathy +\DoMath{#1 + \value{CharChaModCount}}}
	\ifthenelse{#1 > 1}{
		\AddClassFeature{Woodland StRide}
	\ifthenelse{#1 > 2}{
		\AddClassFeature{Trackless Step}
	\ifthenelse{#1 > 3}{
		\AddClassFeature{Resist Nature's Lure}\AddConditionalDefMod{+4 to saves vs. Spell-like abilities of fey and Spells that target plants}
		\NewCounter{CharwildshapeusesCount}
		\SetCounter{CharwildshapeusesCount}{#1 / 2 - 1}
		\AddClassFeature{Wild Shape \ifthenelse{#1 < 20}{}{(At-Will)}
		\ifthenelse{#1 > 5}{\ifthenelse{#1 > 7}{\ifthenelse{#1 > 9}{\ifthenelse{#1 > 11}{
		\\~~~~Beast Shape III\\~~~~Elemental Body IV\\~~~~Plant Shape III
		}{\\~~~~Beast Shape III\\~~~~Elemental Body III\\~~~~Plant Shape II}
		}{\\~~~~Beast Shape III\\~~~~Elemental Body II\\~~~~Plant Shape I}
		}{\\~~~~Beast Shape II\\~~~~Elemental Body I}
		}{\\~~~~Beast Shape I}
		}
		\ifthenelse{#1 < 20}{
			\AddLimitedUse{Wild Shape}{\arabic{CharwildshapeusesCount}}
		}{}
	\ifthenelse{#1 > 8}{
		\AddClassFeature{Venom Immunity}
		\AddImmunity{poison}
	\ifthenelse{#1 > 12}{
		\AddClassFeature{A Thousand Faces}
	\ifthenelse{#1 > 14}{
		\AddClassFeature{Timeless Body}
	}{}}{}}{}}{}}{}}{}
	\newcommand{\AddDruidSpellcasting}[1]{
		\newSpellcasting[(##1 + 1) / 2]{Druid}{##1}{wis}
		\AddPrimarySpellcasting{##1}
	}
}

\def\FighterBAB{g}
\def\FighterFort{g}
\def\FighterRef{p}
\def\FighterWill{p}
\NewCounter{FighterSkillRanksPerLevelCount}
\SetCounter{FighterSkillRanksPerLevelCount}{2}
\NewCounter{FighterHitDieSize}
\SetCounter{FighterHitDieSize}{10}
\edef\FighterClassSkillsList{}
\forcsvlist{\listadd{\FighterClassSkillsList}}{Climb, Craft, HandleAnimal, Intimidate, KnowledgeDungeoneering, KnowledgeEngineering, Profession, Ride, Survival, Swim}
\newcommand{\AddFighterClassFeatures}[1]{
	\AddToCounter{CharBonusFeatsCount}{#1 / 2 +1}
	\AddClassFeature{Fighter Bonus Feat\ifthenelse{#1 > 1}{ $\times\DoMath{#1 / 2 +1}$}{}}
	\ifthenelse{#1 > 1}{
		\AddClassFeature{Bravery +\DoMath{(#1 + 2) / 4}}
			\AddConditionalDefMod{+\DoMath{(#1 + 2) / 4} vs. fear}
	\ifthenelse{#1 > 2}{
		\AddClassFeature{Armor Training +\DoMath{(#1 + 1) / 4} (\ifthenelse{#1 > 6}{Heavy}{Medium})}
	\ifthenelse{#1 > 4}{
		\AddClassFeature{Weapon Training}
		\edef\CharFighterWeaponTrainingList{}
		\NewCounter{CharWeaponTrainingBonusCount}
		\NewCounter{CharWeaponTrainingCount}
		\SetCounter{CharWeaponTrainingBonusCount}{(#1 - 1) / 4}
		\SetCounter{CharWeaponTrainingCount}{(#1 - 1) / 4}
		\newcommand{\AddFighterWeaponTraining}[1]{
			\listadd{\CharFighterWeaponTrainingList}{#1}
			\AddToCounter{CharWeaponTrainingCount}{-1}
		}
		\renewcommand{\do}[1]{
			\\~~~~##1 (+\arabic{CharWeaponTrainingBonusCount})%
			\AddToCounter{CharWeaponTrainingBonusCount}{-1}
		}
		\dolistloop{\CharFighterWeaponTrainingList}
		\gappto{\RunChecks}{%
			%%CHECK FIGHTER WEAPON TRAINING
			\ifthenelse{\value{CharWeaponTrainingCount} < 0}{
				\AddWarning{\DoMath{-\value{CharWeaponTrainingCount}} too many weapon groups for Fighter weapon training}
			}{
			\ifthenelse{\value{CharWeaponTrainingCount} > 0}{
				\AddWarning{Choose \arabic{CharWeaponTrainingCount} more weapon groups for Fighter weapon training}
			}{}}
		}
	\ifthenelse{#1 > 18}{
		\AddClassFeature{Armor Mastery}
		\preto{\Initialize}{
			\ifthenelse{\equal{\CharArmorName}{}}{}{\AddDR{--}{5}}
			\ifthenelse{\equal{\CharShieldName}{}}{}{\AddDR{--}{5}}
		}
	\ifthenelse{#1 > 19}{
		\AddClassFeature{Weapon Mastery \CharFighterWeaponMastery}
		\newcommand{\CharFighterWeaponMastery}{}
		\newcommand{\AddFighterWeaponMastery}[1]{
			\renewcommand{\CharFighterWeaponMastery}{##1}
		}
		\gappto{\RunChecks}{%
			%%Check Fighter Weapon Mastery
			\ifthenelse{\equal{\CharFighterWeaponMastery}{}}{
				\AddWarning{Choose a weapon for Fighter weapon mastery. Use the command \texttt{$\backslash$addFighterWeaponMastery\{weapon\}}}
			}{}
		}
	}{}}{}}{}}{}}{}
}


\def\MonkBAB{a}
\def\MonkFort{g}
\def\MonkRef{g}
\def\MonkWill{g}
\NewCounter{MonkSkillRanksPerLevelCount}
\SetCounter{MonkSkillRanksPerLevelCount}{4}
\NewCounter{MonkHitDieSize}
\SetCounter{MonkHitDieSize}{8}
\edef\MonkClassSkillsList{}
\forcsvlist{\listadd{\MonkClassSkillsList}}{Acrobatics, Climb, Craft, EscapeArtist, Intimidate, KnowledgeHistory, KnowledgeReligion, Perception, Perform, Profession, Ride, SenseMotive, Stealth, Swim}
\newcommand{\AddMonkClassFeatures}[1]{
		\AddClassFeature{\ifthenelse{#1 > 10}{Greater }Flurry of Blows}
			\NewCounter{CharflurryofblowspenaltyCount}\SetCounter{CharflurryofblowspenaltyCount}{-2}
			\NewCounter{CharflurryofblowsattacksCount}\StepCounter{CharflurryofblowsattacksCount}
%			\autoweapon[\value{CharflurryofblowsattacksCount}]{Flurry of Blows}{\value{CharflurryofblowspenaltyCount}}{\Charunarmedstrikedamage + \arabic{CharstrModCount}}{20}{B}{Melee}{}{str}
		\AddClassFeature{Monk Bonus Feat\ifthenelse{#1 > 1}{$\times \ifthenelse{#1 > 5}{\DoMath{(#1 + 6) / 4}}{2}$}{}}
		\AddToCounter{CharBonusFeatsCount}{3}
		\AddFeat*{Improved Unarmed Strike}
		\AddFeat*{Stunning Fist}\AddLimitedUse{Stunning Fist}{\DoMath{#1 + (\value{CharTotalLevelCount} - 1) / 4}}
		\AddClassFeature{Stunning Fist \ifthenelse{#1 > 3}{(Stun 1 rd, fatigue\ifthenelse{#1 > 7}{, sicken 1 min\ifthenelse{#1 > 11}{, stagger 1d6+1 rd\ifthenelse{#1 > 15}{, blind, deafen\ifthenelse{#1 > 19}{, paralyze 1d6 + 1 rd.}{}}{}}{.}}{})}{}}
		\AddClassFeature{Unarmed Strike \Charunarmedstrikedamage}
			\newcommand{\Charunarmedstrikedamage}{
				\ifthenelse{\equal{\CharSize}{Small}}{%
					\ifthenelse{#1 > 15}{2d\DoMath{6 + ((#1 - 16)/ 4) * 2}}{1d\DoMath{4 + (#1 / 4) * 2}}%
				}{%
				\ifthenelse{\equal{\CharSize}{Medium}}{%
					\ifthenelse{#1 > 11}{2d\DoMath{6 + ((#1 - 12)/ 4) * 2}}{1d\DoMath{6 + (#1 / 4) * 2}}%
				}{%
				\ifthenelse{\equal{\CharSize}{Large}}{%
					\ifthenelse{#1 > 3}{%
						\ifthenelse{#1 > 11}{%
							\ifthenelse{#1 > 19}{4d8}{%
							3d\DoMath{6 + ((#1 - 12)/ 4) * 2}}%
						}{%
							2d\DoMath{6 + ((#1 - 4)/ 4) * 2}%
						}%
					}{%
						1d8%
					}%
				}{}}{}}{}
			}
		\AddClassFeature{Monk AC Bonus}
			\appto\Initialize{
				\ifthenelse{\equal{\CharArmorType}{}}{
					\MiscBonus{AC}{#1 / 4 + \value{CharWisModCount}}
					\MiscBonus{TouchAC}{#1 / 4 + \value{CharWisModCount}}
					\MiscBonus{FlatFootedAC}{#1 / 4 + \value{CharWisModCount}}
					\MiscBonus{CMD}{#1 / 4 + \value{CharWisModCount}}
				}{}
			}
	\ifthenelse{#1 > 1}{
		\AddClassFeature{\ifthenelse{#1 > 8}{Improved }{}Evasion}
		\ifthenelse{#1 > 8}{\AddSpecialDefense{Improved Evasion}}{\AddSpecialDefense{Evasion}}
		\StepCounter{CharBonusFeatsCount}
	\ifthenelse{#1 > 2}{
		\AddClassFeature{Still Mind}\AddConditionalDefMod{+2 on saves vs. EnChantment}
		\AddClassFeature{Fast Movement}
			\EnhancementBonus{Speed}{#1 / 3 * 10}
		\AddClassFeature{Maneuver Training}
			\MiscBonus{CMD}{#1 - #1 * 3 / 4}
			\MiscBonus{CMB}{#1 - #1 * 3 / 4}
	\ifthenelse{#1 > 3}{
		\AddLimitedUse{Ki Pool}{\arabic{CharKiPoolCount}}
			\NewCounter{CharKiPoolCount}
			\SetCounter{CharKiPoolCount}{#1 / 2 + \value{CharWisModCount}}
			\AddClassFeature{Ki Strike (magic%
				\ifthenelse{#1 > 6}{%
				, cold iron, silver
				\ifthenelse{#1 > 9}{%
				, lawful%
				\ifthenelse{#1 > 15}{, adamantine}{}%
				}{}}{})
			}
		\AddClassFeature{Slow Fall \ifthenelse{#1 < 20}{\DoMath{#1 / 2}0 ft.}{any distance}}
	\ifthenelse{#1 > 4}{
		\AddClassFeature{High Jump}
			\AddConditionalSkillMod{+#1 to Acrobatics to jump, always Counts as having running start for jumps}
		\AddClassFeature{Purity of Body}\AddImmunity{Disease}
		\StepCounter{CharflurryofblowspenaltyCount}
	\ifthenelse{#1 > 5}{
		\AddToCounter{CharBonusFeatsCount}{(#1 - 2) / 4}
	\ifthenelse{#1 > 6}{
		\AddClassFeature{Wholeness of Body}
	\ifthenelse{#1 > 8}{
		\StepCounter{CharflurryofblowspenaltyCount}
	\ifthenelse{#1 > 10}{
		\StepCounter{CharflurryofblowsattacksCount}
		\AddClassFeature{Diamond Body}\AddImmunity{poison}
	\ifthenelse{#1 > 11}{
		\AddClassFeature{Abundant Step (\DoMath{#1 * 40 + 400} ft.)}
	\ifthenelse{#1 > 12}{
		\AddClassFeature{Diamond Soul}\AddSpellResistance{#1 + 10}
	\ifthenelse{#1 > 14}{
		\AddLimitedUse{Quivering Palm (DC \DoMath{10 + #1 / 2 + \value{CharWisModCount}})}{1}
	\ifthenelse{#1 > 16}{
		\AddClassFeature{Timeless Body}
		\AddClassFeature{Tongue of the Sun and Moon}\listadd{\CharLanguagesList}{Can speak with any living creature}
	\ifthenelse{#1 > 18}{
		\AddClassFeature{Empty Body}
	\ifthenelse{#1 > 19}{
		\AddClassFeature{Perfect Self}\AddDR{Chaotic}{10}
	}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}
}

\def\PaladinBAB{g}
\def\PaladinFort{g}
\def\PaladinRef{p}
\def\PaladinWill{g}
\NewCounter{PaladinSkillRanksPerLevelCount}
\SetCounter{PaladinSkillRanksPerLevelCount}{2}
\NewCounter{PaladinHitDieSize}
\SetCounter{PaladinHitDieSize}{10}
\edef\PaladinClassSkillsList{}
\forcsvlist{\listadd{\PaladinClassSkillsList}}{Craft, Diplomacy, HandleAnimal, Heal, KnowledgeNobility, KnowledgeReligion, Profession, Ride, SenseMotive, Spellcraft}
\newcommand{\AddPaladinClassFeatures}[1]{
		\AddClassFeature{Aura of Good}
		\AddClassFeature{Detect Evil}
		\AddLimitedUse{Smite Evil}{\DoMath{(#1 + 2) / 3}}
	\ifthenelse{#1 > 1}{
		\AddClassFeature{Divine Grace}{
			\gappto\Initialize{
				\MiscBonus{Fortitude}{\value{CharChaModCount}}
				\MiscBonus{Reflex}{\value{CharChaModCount}}
				\MiscBonus{Will}{\value{CharChaModCount}}
			}
		}
		\AddLimitedUse{Lay on Hands \DoMath{#1 / 2}d6}{\DoMath{#1 / 2 + \value{CharChaModCount}}}
	\ifthenelse{#1 > 2}{
		\AddClassFeature{Aura of Courage}\AddImmunity{Fear}
		\AddClassFeature{Divine Health}\AddImmunity{Disease}
		\edef\CharPaladinMerciesList{}
			\NewCounter{CharPaladinMerciesCount}
			\AddToCounter{CharPaladinMerciesCount}{#1 / 3}
			\AddClassFeature{Mercies:\forlistloop{\\~~~~}{\CharPaladinMerciesList}}
			\NewDocumentCommand{\AddMercy}{m}{
				\listinsert{\CharPaladinMerciesList}{##1}
				\AddToCounter{CharPaladinMerciesCount}{-1}
			}
			\gappto{\RunChecks}{%
				%%CHECK MERCIES
				\ifthenelse{\value{CharPaladinMerciesCount} < 0}{
					\AddWarning{\DoMath{-\value{CharPaladinMerciesCount}} too many mercies}
				}{
				\ifthenelse{\value{CharPaladinMerciesCount} > 0}{
					\AddWarning{Choose \arabic{CharPaladinMerciesCount} more mercies}
				}{}}
			}
	\ifthenelse{#1 > 3}{
		\AddClassFeature{Channel Energy (2 Lay on Hands)}
		\newcommand{\AddPaladinSpellcasting}[1]{
			\SetCounter{@i}{0}
			\ifthenelse{##1 > 3}{
				\StepCounter{@i}
			\ifthenelse{##1 > 7}{
				\StepCounter{@i}
			\ifthenelse{##1 > 11}{
				\StepCounter{@i}
			\ifthenelse{##1 > 13}{
				\StepCounter{@i}
			}{}}{}}{}}{}
			\newSpellcasting*[\value{@i}]{Paladin}{##1 / 2}{Cha}
			\AddHalfSpellcasting{##1}
		}
	\ifthenelse{#1 > 4}{
		\AddClassFeature{Divine Bond}
	\ifthenelse{#1 > 7}{
		\AddClassFeature{Aura of Resolve}\AddImmunity{Charms}
	\ifthenelse{#1 > 10}{
		\AddClassFeature{Aura of Justice}
	\ifthenelse{#1 > 13}{
		\AddClassFeature{Aura of Faith}
	\ifthenelse{#1 > 16}{
		\AddClassFeature{Aura of Righteousness}
			\AddImmunity{Compulsions}
			\AddDR{evil}{5}
	\ifthenelse{#1 > 19}{
		\AddClassFeature{Holy Champion}
			\AddDR{evil}{10}
	}{}}{}}{}}{}}{}}{}}{}}{}}{}
}

\def\RangerBAB{g}
\def\RangerFort{g}
\def\RangerRef{g}
\def\RangerWill{p}
\NewCounter{RangerSkillRanksPerLevelCount}
\SetCounter{RangerSkillRanksPerLevelCount}{6}
\NewCounter{RangerHitDieSize}
\SetCounter{RangerHitDieSize}{8}
\edef\RangerClassSkillsList{}
\forcsvlist{\listadd{\RangerClassSkillsList}}{Climb, Craft, HandleAnimal, Heal, Intimidate, KnowledgeDungeoneering, KnowledgeGeography, KnowledgeNature, Perception, Profession, Ride, Spellcraft, Stealth, Survival, Swim}
\newcommand{\AddRangerClassFeatures}[1]{
		\edef\CharFavoredEnemiesList{}
		\AddClassFeature{Favored Enemy\forlistloop{\\~~~~}{\CharFavoredEnemiesList}}
			\edef\CharFavoredEnemiesList{}
			\NewCounter{CharFavoredEnemiesCount}
			\SetCounter{CharFavoredEnemiesCount}{#1 / 5 + 1}
			\NewCounter{CharFavoredEnemiesTotalBonusCount}
			\SetCounter{CharFavoredEnemiesTotalBonusCount}{(#1 / 5) * 4 + 2}
			\newcommand{\AddFavoredEnemy}[2]{
				\listinsert{\CharFavoredEnemiesList}{+##2 vs ##1s}
				\AddToCounter{CharFavoredEnemiesTotalBonusCount}{-##2}
				\AddToCounter{CharFavoredEnemiesCount}{-1}
				\AddConditionalSkillMod{+##2 to Bluff, Listen, Sense Motive, Spot, and Survival vs. ##1s}
				\AddConditionalAttackMod{+##2 damage vs. ##1s}
			}
			\appto{\RunChecks}{%
				%%Check Favored Enemies
				\ifthenelse{\value{CharFavoredEnemiesCount} > 0}{
					\AddWarning{Choose \arabic{CharFavoredEnemiesCount} more favored enemies. Use the command \texttt{$\backslash$addfavoredenemy\{enemy\}\{Bonus\}}}
				}{
				\ifthenelse{\value{CharFavoredEnemiesCount} < 0}{
					\AddWarning{\DoMath{-\value{CharFavoredEnemiesCount}} too many favored enemies}
				}{}}
				\ifthenelse{\value{CharFavoredEnemiesTotalBonusCount} > 0}{
					\AddWarning{You have \arabic{CharFavoredEnemiesTotalBonusCount} points of favored enemy Bonus to allocate}
				}{
				\ifthenelse{\value{CharFavoredEnemiesTotalBonusCount} < 0}{
					\AddWarning{Total favored enemy Bonus is \DoMath{-\value{CharFavoredEnemiesTotalBonusCount}} points too high}
				}{}}
			}
		\AddClassFeature{Track}
			\ifthenelse{#1 > 1}{\AddConditionalSkillMod{+\DoMath{#1 / 2} to Survival checks to follow tracks}}{\AddConditionalSkillMod{+1 to Survival checks to follow tracks}}
		\AddClassFeature{Wild Empathy +\DoMath{#1 + \value{CharChaModCount}}}
	\ifthenelse{#1 > 1}{
		\AddClassFeature{Combat Style Bonus Feat\ifthenelse{#1 > 5}{$ \times \DoMath{(#1 + 2) / 4}$}{}: \Charcombatstyle}
			\StepCounter{CharBonusFeatsCount}
			\newcommand\Charcombatstyle{}
			\newcommand\Addcombatstyle[1]{%
				\renewcommand{\Charcombatstyle}{##1}%
			}
			\appto{\RunChecks}{%
				%Check Ranger Combat Style
				\ifthenelse{\equal{\Charcombatstyle}{}}{
					\AddWarning{Choose a Ranger combat style. Use the command \texttt{$\backslash$addcombatstyle\{combat style\}}}
				}{}
			}
			\AddToCounter{CharBonusFeatsCount}{(#1 + 2) / 4}
	\ifthenelse{#1 > 2}{
		\AddClassFeature{Endurance}
			\StepCounter{CharBonusFeatsCount}
			\AddFeat*{Endurance}
		\NewCounter{CharFavoredTerrainsCount}
			\SetCounter{CharFavoredTerrainsCount}{(#1 + 2)/ 5}
			\NewCounter{CharFavoredTerrainsTotalBonusCount}
			\SetCounter{CharFavoredTerrainsTotalBonusCount}{(#1 + 2) / 5 * 4 - 2}
			\newcommand{\Addfavoredterrain}[2]{
				\listinsert{\CharFavoredTerrainslist}{+##2 vs ##1s}
				\AddToCounter{CharFavoredTerrainsTotalBonusCount}{-##2}
				\AddToCounter{CharFavoredTerrainsCount}{-1}
				\AddConditionalSkillMod{+##2 to initiative, Knowledge (geography), Perception, Stealth, andSurvival while in ##1 terrain}
				\AddConditionalAttackMod{+##2 damage vs. ##1s}
			}
			\appto{\RunChecks}{%
				%%Check Favored Terrains
				\ifthenelse{\value{CharFavoredTerrainsCount} > 0}{
					\AddWarning{Choose \arabic{CharFavoredTerrainsCount} more favored terrains. Use the command \texttt{$\backslash$addfavoredterrain\{terrain\}\{Bonus\}}}
				}{
				\ifthenelse{\value{CharFavoredTerrainsCount} < 0}{
					\AddWarning{\DoMath{-\value{CharFavoredTerrainsCount}} too many favored terrains}
				}{}}
				\ifthenelse{\value{CharFavoredTerrainsTotalBonusCount} > 0}{
					\AddWarning{You have \arabic{CharFavoredTerrainsTotalBonusCount} points of favored terrain Bonus to allocate}
				}{
				\ifthenelse{\value{CharFavoredTerrainsTotalBonusCount} < 0}{
					\AddWarning{Total favored terrain Bonus is \DoMath{-\value{CharFavoredTerrainsTotalBonusCount}} points too high}
				}{}}
			}
	\ifthenelse{#1 > 3}{
		\AddClassFeature{Hunter's Bond}
		\newcommand{\AddRangerSpellcasting}[1]{
			\SetCounter{@i}{0}
			\ifthenelse{##1 > 3}{
				\StepCounter{@i}
			\ifthenelse{##1 > 7}{
				\StepCounter{@i}
			\ifthenelse{##1 > 11}{
				\StepCounter{@i}
			\ifthenelse{##1 > 13}{
				\StepCounter{@i}
			}{}}{}}{}}{}
			\newSpellcasting*[\value{@i}]{Ranger}{##1 / 2}{wis}
			\AddHalfSpellcasting{##1}
		}
	\ifthenelse{#1 > 6}{
		\AddClassFeature{Woodland Stride}
	\ifthenelse{#1 > 7}{
		\AddClassFeature{Swift Tracker}
			\AddConditionalSkillMod{No penalty for tracking at full Speed}
			\AddConditionalSkillMod{half penalty for tracking at twice Speed}
	\ifthenelse{#1 > 8}{
		\AddClassFeature{\ifthenelse{#1 > 15}{Improved }{}Evasion}
			\ifthenelse{#1 > 15}{\AddSpecialDefense{Improved Evasion}}{\AddSpecialDefense{Evasion}}
	\ifthenelse{#1 > 10}{
		\AddClassFeature{\ifthenelse{#1 > 18}{Improved }{}Quarry}
	\ifthenelse{#1 > 12}{
		\AddClassFeature{Camouflage}
	\ifthenelse{#1 > 16}{
		\AddClassFeature{Hide in Plain Sight}
	\ifthenelse{#1 > 19}{
		\AddClassFeature{Master Hunter (DC \DoMath{10 + #1 / 2 + \value{CharWisModCount}})}
	}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}
}

\def\RogueBAB{a}
\def\RogueFort{p}
\def\RogueRef{g}
\def\RogueWill{p}
\NewCounter{RogueSkillRanksPerLevelCount}
\SetCounter{RogueSkillRanksPerLevelCount}{8}
\NewCounter{RogueHitDieSize}
\SetCounter{RogueHitDieSize}{8}
\edef\RogueClassSkillsList{}
\forcsvlist{\listadd{\RogueClassSkillsList}}{Acrobatics, Appraise, Bluff, Climb, Craft, Diplomacy, DisableDevice, Disguise, EscapeArtist, Intimidate, KnowledgeDungeoneering, KnowledgeLocal, Linguistics, Perception, Perform, Profession, SenseMotive, SleightOfHand, Stealth, Swim, UseMagicDevice}
\newcommand{\AddRogueClassFeatures}[1]{
		\AddClassFeature{Sneak Attack +\DoMath{(#1 + 1)/2}d6}
		\AddClassFeature{Trapfinding}
			\AddConditionalSkillMod{+ \DoMath{#1 / 2} to Perception to find traps}
			\MiscBonus{DisableDevice}{#1 / 2}
	\edef\CharRogueTalentsList{}
	\NewCounter{CharRogueTalentsCount}
	\ifthenelse{#1 > 1}{
		\AddClassFeature{Evasion}
			\AddSpecialDefense{\ifinlist{Improved Evasion}{\CharRogueTalentsList}{Improved }{}Evasion}
		\AddClassFeature{\ifthenelse{#1 > 9}{Advanced }{}Rogue Talents\forlistloop{\\~~~~}{\CharRogueTalentsList}}
			\AddToCounter{CharRogueTalentsCount}{#1 / 2}
			\NewDocumentCommand{\AddRogueTalent}{m}{
				\listinsert{\CharRogueTalentsList}{##1}
				\AddToCounter{CharRogueTalentsCount}{-1}
			}
			\gappto{\RunChecks}{%
				%%CHECK ROGUE TALENTS
				\ifthenelse{\value{CharRogueTalentsCount} < 0}{
					\AddWarning{\DoMath{-\value{CharRogueTalentsCount}} too many Rogue talents}
				}{
				\ifthenelse{\value{CharRogueTalentsCount} > 0}{
					\AddWarning{Choose \arabic{CharRogueTalentsCount} more Rogue talents}
				}{}}
			}
	\ifthenelse{#1 > 2}{
		\AddClassFeature{Trap Sense +\DoMath{#1 / 3}}
			\AddConditionalDefMod{+\DoMath{#1 / 3} to Reflex and AC vs. traps}
	\ifthenelse{#1 > 3}{
		\AddClassFeature{\ifthenelse{#1 > 7}{Improved }{}Uncanny Dodge}
			\ifthenelse{#1 > 7}{\AddSpecialDefense{Improved Uncanny Dodge}}{\AddSpecialDefense{Uncanny Dodge}}
	\ifthenelse{#1 > 19}{
		\AddClassFeature{Master Strike (DC \DoMath{10 + #1 / 2 + \value{CharIntModCount}})}
	}{}}{}}{}}{}
}

\def\SorcererBAB{p}
\def\SorcererFort{p}
\def\SorcererRef{p}
\def\SorcererWill{g}
\NewCounter{SorcererSkillRanksPerLevelCount}
\SetCounter{SorcererSkillRanksPerLevelCount}{2}
\NewCounter{SorcererHitDieSize}
\SetCounter{SorcererHitDieSize}{6}
\edef\SorcererClassSkillsList{}
\forcsvlist{\listadd{\SorcererClassSkillsList}}{Appraise, Bluff, Craft, Fly, Intimidate, KnowledgeArcana, Profession, Spellcraft, UseMagicDevice}
\newcommand{\AddSorcererClassFeatures}[1]{
	\edef\CharSorcererBloodlinePowersList{}
	\newcommand\CharSorcererBloodline{}
	\AddClassFeature{\CharSorcererBloodline BloodlineArcana}
	\AddClassFeature{\CharSorcererBloodline Bloodline Powers:\forlistloop{\\~~~~}{\CharSorcererBloodlinePowersList}}
		\NewCounter{CharSorcererBloodlinePowersCount}
		\newcommand{\AddSorcererBloodline}[1]{\renewcommand{\CharSorcererBloodline}{##1}}
		\appto{\RunChecks}{%
			%%Check Sorcerer Bloodline
			\ifthenelse{\equal{\CharSorcererBloodline}{}}{
				\AddWarning{Choose a Sorcerer bloodline. Use the command \texttt{$\backslash$addSorcererBloodline\{bloodline\}}}
			}{}
		}
		\StepCounter{CharSorcererBloodlinePowersCount}
		\NewDocumentCommand{\AddBloodlinePower}{m}{
			\listinsert{\CharSorcererBloodlinePowersList}{##1}
			\AddToCounter{CharSorcererBloodlinePowersCount}{-1}
		}
		\gappto{\RunChecks}{%
			%%CHECK BLOODLINE POWERS
			\ifthenelse{\value{CharSorcererBloodlinePowersCount} < 0}{
				\AddWarning{\DoMath{-\value{CharSorcererBloodlinePowersCount}} too many bloodline powers input}
			}{
			\ifthenelse{\value{CharSorcererBloodlinePowersCount} > 0}{
				\AddWarning{Input \arabic{CharSorcererBloodlinePowersCount} bloodline powers}
			}{}}
		}
	\StepCounter{CharBonusFeatsCount}\AddFeat*{Eschew Materials}
	\newcommand{\AddBloodlineSpells}{}
	\ifthenelse{#1 > 2}{
		\StepCounter{CharSorcererBloodlinePowersCount}
		\AddClassFeature{Bloodline Spell\ifthenelse{#1 > 4}{ $\times \DoMath{(#1 - 1) / 2}$}{}}
			\appto{\AddBloodlineSpells}{
				\AddSpellsKnown{1}{1}
			}
	\ifthenelse{#1 > 4}{
		\appto{\AddBloodlineSpells}{
			\AddSpellsKnown{2}{1}
		}
	\ifthenelse{#1 > 6}{
		\appto{\AddBloodlineSpells}{
			\AddSpellsKnown{3}{1}
		}
		\AddClassFeature{Bloodline Feat\ifthenelse{#1 > 12}{ $\times \DoMath{(#1 - 1) / 6}$}{}}
			\AddToCounter{CharBonusFeatsCount}{(#1 - 1) / 6}
	\ifthenelse{#1 > 8}{
		\StepCounter{CharSorcererBloodlinePowersCount}
		\appto{\AddBloodlineSpells}{
			\AddSpellsKnown{4}{1}
		}
	\ifthenelse{#1 > 10}{
		\appto{\AddBloodlineSpells}{
			\AddSpellsKnown{5}{1}
		}
	\ifthenelse{#1 > 12}{
		\appto{\AddBloodlineSpells}{
			\AddSpellsKnown{6}{1}
		}
	\ifthenelse{#1 > 14}{
		\appto{\AddBloodlineSpells}{
			\AddSpellsKnown{7}{1}
		}
		\StepCounter{CharSorcererBloodlinePowersCount}
	\ifthenelse{#1 > 16}{
		\appto{\AddBloodlineSpells}{
			\AddSpellsKnown{8}{1}
		}
	\ifthenelse{#1 > 18}{
		\appto{\AddBloodlineSpells}{
			\AddSpellsKnown{9}{1}
		}
	\ifthenelse{#1 > 19}{
		\StepCounter{CharSorcererBloodlinePowersCount}
	}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}
	\newcommand{\AddSorcererSpellcasting}[1]{
		\ifthenelse{##1 = 1}{
			\newSpellcasting[1]{Sorcerer}{##1}{Cha}
		}{
			\newSpellcasting[##1 / 2]{Sorcerer}{##1}{Cha}
		}
		\AddSpontaneousPrimarySpellcasting{##1}
		\ifthenelse{##1 > 9}{\AddSpellsKnown{0}{9}}{\AddSpellsKnown{0}{{##1/2 + 4}}}
		\ifthenelse{##1 > 6}{\AddSpellsKnown{1}{5}}{\AddSpellsKnown{1}{##1/3 + 2}}
		\ifthenelse{##1 > 10}{
			\AddSpellsKnown{2}{5}
			\AddSpellsKnown{3}{4}
		}{
			\AddSpellsKnown{2}{(##1 - 1)/2}
			\AddSpellsKnown{3}{(##1 - 3)/2}
		}
		\ifthenelse{##1 > 12}{\AddSpellsKnown{4}{4}}{\AddSpellsKnown{4}{(##1 - 5)/2}}
		\ifthenelse{##1 > 14}{
			\AddSpellsKnown{5}{4}
			\AddSpellsKnown{6}{3}
		}{
			\AddSpellsKnown{5}{(##1 - 7)/2}
			\AddSpellsKnown{6}{(##1 - 9)/2}
		}
		\ifthenelse{##1 > 16}{\AddSpellsKnown{7}{3}}{\AddSpellsKnown{7}{(##1 - 11)/2}}
		\AddSpellsKnown{8}{(##1 - 13) / 2}
		\AddSpellsKnown{9}{##1 - 17}
		\AddBloodlineSpells
	}
	
}

\def\WizardBAB{p}
\def\WizardFort{p}
\def\WizardRef{p}
\def\WizardWill{g}
\NewCounter{WizardSkillRanksPerLevelCount}
\SetCounter{WizardSkillRanksPerLevelCount}{2}
\NewCounter{WizardHitDieSize}
\SetCounter{WizardHitDieSize}{6}
\edef\WizardClassSkillsList{}
\forcsvlist{\listadd{\WizardClassSkillsList}}{Appraise, Craft, Fly, KnowledgeAll, Linguistics, Profession, Spellcraft}
\NewDocumentCommand{\AddWizardClassFeatures}{m O{Universal} O{} O{}}{
	\AddClassFeature{Arcane Bond}
	\AddClassFeature{Scribe Scroll}
	\AddToCounter{CharBonusFeatsCount}{#1 / 5 + 1}
	\AddFeat*{Scribe Scroll}
	\ifthenelse{#1 > 4}{
		\AddClassFeature{Wizard Bonus Feat\ifthenelse{#1 > 9}{ $\times\DoMath{#1 / 5}$}{}}
	}{}
	\ifthenelse{\equal{#2}{Universal}}{
		\newcommand{\CharWizardFocusSchool}{}
			\AddLimitedUse{Hand of the Apprentice}{\DoMath{3 + \value{CharIntModCount}}}
		\ifthenelse{#1 > 7}{
			\AddLimitedUse{Metamagic Mastery}{\DoMath{(#1 - 6) / 2}}
		}{}
	}{\ifthenelse{\equal{#2}{Abjuration}}{
		\newcommand{\CharWizardFocusSchool}{Abjuration}
			\AddClassFeature{Resistance}
				\ifthenelse{#1 > 19}{
					\AddImmunity{Chosen Energy}
				}{\ifthenelse{#1 > 10}{
					\AddResistance{Chosen Energy}{10}
				}{
					\AddResistance{Chosen Energy}{5}
				}}
			\AddLimitedUse{Protective Ward +\DoMath{1 + #1 / 5} (\arabic{CharIntModCount} rd.)}{\DoMath{3 + \value{CharIntModCount}}}
		\ifthenelse{#1 > 5}{
			\AddLimitedUse{Energy Absorption (points)}{\DoMath{#1 * 3}}
		}{}
	}{\ifthenelse{\equal{#2}{Conjuration}}{
		\newcommand{\CharWizardFocusSchool}{Conjuration}
			\AddClassFeature{SummOner's Charm}
				\appto{\AddWizardSpellcasting}{\AddSpellcastingNote{Increase duration of \textit{summon monster} Spells by \DoMath{#1 / 2} round\ifthenelse{#1 > 3}{s}{}}}
			\AddLimitedUse{Acid Dart 1d6 \ifthenelse{#1 > 1}{+ \DoMath{#1 / 2}}{}}{\DoMath{3 + \value{CharIntModCount}}}
		\ifthenelse{#1 > 7}{
			\AddLimitedUse{Dimensional Steps (ft.)}{\DoMath{#1 * 30}}
		}{}
	}{\ifthenelse{\equal{#2}{Divination}}{
		\newcommand{\CharWizardFocusSchool}{Divination}
			\AddClassFeature{Forewarned}
				\MiscBonus{initiative}{#1 / 2}
			\AddLimitedUse{Diviner's Fortune +\DoMath{#1 / 2}}{\DoMath{3 + \value{CharIntModCount}}}
		\ifthenelse{#1 > 7}
			\AddClassFeature{Scrying Adept}
				\AddSpecialDefense{Permanent \textit{detect scrying}}
				\appto{\AddWizardSpellcasting}{\AddSpellcastingNote{Scry as if subject is One step more familiar}}
		}{}
	}{\ifthenelse{\equal{#2}{EnChantment}}{
		\newcommand{\CharWizardFocusSchool}{EnChantment}
			\AddClassFeature{EnChanting Smile}
				\MiscBonus[enhancement]{Bluff}{2 + #1 / 5}
				\MiscBonus[enhancement]{Diplomacy}{2 + #1 / 5}
				\MiscBonus[enhancement]{Intimidate}{2 + #1 / 5}
			\AddLimitedUse{Dazing Touch}{\DoMath{3 + \value{CharIntModCount}}}
		\ifthenelse{#1 > 7}
			\AddLimitedUse{Aura of Despair (rounds)}{#1}
		}{}
	}{\ifthenelse{\equal{#2}{Evocation}}{
		\newcommand{\CharWizardFocusSchool}{Evocation}
			\AddClassFeature{Intense Spells +\DoMath{#1 / 2}}
				\appto{\AddWizardSpellcasting}{\AddSpellcastingNote{+\DoMath{#1 / 2} damage on Evocations that deal HP damage.}}
				\ifthenelse{#1 > 19}{
					\appto{\AddWizardSpellcasting}{\AddSpellcastingNote{Roll twice on rolls to penetrate Spell Resistance for evocation Spells}}
				}{}
			\AddLimitedUse{Force Missile 1d4+\DoMath{#1 / 2}}{\DoMath{3 + \value{CharIntModCount}}}
		\ifthenelse{#1 > 7}{
			\AddLimitedUse{Elemental Wall (rounds)}{#1}
		}{}
	}{\ifthenelse{\equal{#2}{Illusion}}{
		\newcommand{\CharWizardFocusSchool}{Illusion}
			\AddClassFeature{Extended Illusions}
				\appto{\AddWizardSpellcasting}{\AddSpellcastingNote{+\ifthenelse{#1 = 1}{1}{\DoMath{#1 / 2}} round duration to illusions with Concentration duration.}}
			\AddLimitedUse{Blinding Ray}{\DoMath{3 + \value{CharIntModCount}}}
		\ifthenelse{#1 > 7}{
			\AddLimitedUse{Invisibility Field (rounds)}{#1}
		}{}
	}{\ifthenelse{\equal{#2}{Necromancy}}{
		\newcommand{\CharWizardFocusSchool}{Necromancy}
			\AddClassFeature{Power Over Undead}
				\StepCounter{CharBonusFeatsCount}
				\NewCounter{CharChannelenergyusesCount}
				\SetCounter{CharChannelenergyusesCount}{3 + \value{CharIntModCount}}
				\AddLimitedUse{Channel Energy (DC \DoMath{10 + #1 / 2 +\value{CharChaModCount}})}{\arabic{CharChannelenergyusesCount}}
			\AddLimitedUse{Grave Touch}{3 + \value{CharIntModCount}}
		\ifthenelse{#1 > 7}{
			\AddLimitedUse{Life Sight \DoMath{(#1 - 4) / 4 * 10} ft. (rounds)}{#1}
		}{}
	}{\ifthenelse{\equal{#2}{Transmutation}}{
		\newcommand{\CharWizardFocusSchool}{Transmutation}
			\AddClassFeature{Physical Enhancement + \DoMath{1 + #1 / 5}}
			\AddLimitedUse{Telekinetic Fist 1d4+\DoMath{#1 / 2}}{\DoMath{3 + \value{CharIntModCount}}}
		\ifthenelse{#1 > 7}{
			\AddLimitedUse{Change Shape (rounds)}{#1}
		}{}
	}}}}}}}
	\NewDocumentCommand{\AddWizardSpellcasting}{m}{
		\newSpellcasting[(##1 + 1) / 2]{Wizard}{##1}{int}
		\NewCounter{CharWizardforbiddenschoolsCount}
		\AddPrimarySpellcasting{##1}
		\ifthenelse{\equal{\CharWizardFocusSchool}{}}{}{
			\ForLoop{@i}{1}{\value{@i}<10}{
				\AddBonusSpellslots{\arabic{@i}}{1}
			}
			\AddSpellcastingSpecialization[Focus School]{\CharWizardFocusSchool}
			\AddToCounter{CharWizardforbiddenschoolsCount}{2}
			\ifthenelse{\equal{#3}{}}{}{
				\AddSpellcastingProhibition[Opposition School]{#3}
				\AddToCounter{CharWizardforbiddenschoolsCount}{-1}
			}
			\ifthenelse{\equal{#4}{}}{}{
				\AddSpellcastingProhibition[Opposition School]{#4}
				\AddToCounter{CharWizardforbiddenschoolsCount}{-1}
			}
		}
		\appto{\RunChecks}{
			%%CHECK NUMBER OF PROHIBITED SCHOOLS
			\ifthenelse{\value{CharWizardforbiddenschoolsCount} > 0}{
				\AddWarning{Choose \arabic{CharWizardforbiddenschoolsCount} more prohibited school\ifthenelse{\value{CharWizardforbiddenschoolsCount} > 1}{s}{}}
			}{
			\ifthenelse{\value{CharWizardforbiddenschoolsCount} < 0}{
				\AddWarning{You can remove \DoMath{-\value{CharWizardforbiddenschoolsCount}} prohibited school\ifthenelse{\value{CharWizardforbiddenschoolsCount} < -1}{s}{}}
			}{}}
		}
	}
}

\newcommand{\AddPrimarySpellcasting}[1]{
	\AddSpellslots{0}{3}
	\AddSpellslots{1}{1}
	\ifthenelse{#1 > 1}{
		\AddSpellslots{0}{1}
		\AddSpellslots{1}{1}
		\ifthenelse{#1 > 2}{
			\AddSpellslots{2}{1}
			\ifthenelse{#1 > 3}{
				\AddSpellslots{0}{1}
				\AddSpellslots{1}{1}
				\AddSpellslots{2}{1}
				\ifthenelse{#1 > 4}{
					\AddSpellslots{3}{1}
					\ifthenelse{#1 > 5}{
						\AddSpellslots{2}{1}
						\AddSpellslots{3}{1}
						\ifthenelse{#1 > 6}{
							\AddSpellslots{4}{1}
							\AddSpellslots{0}{1}
							\AddSpellslots{1}{1}
							\ifthenelse{#1 > 7}{
								\AddSpellslots{3}{1}
								\AddSpellslots{4}{1}
								\ifthenelse{#1 > 8}{
									\AddSpellslots{5}{1}
									\AddSpellslots{2}{1}
									\ifthenelse{#1 > 9}{
										\AddSpellslots{4}{1}
										\AddSpellslots{5}{1}	
										\ifthenelse{#1 > 10}{
											\AddSpellslots{6}{1}
											\AddSpellslots{3}{1}
											\AddSpellslots{1}{1}
											\ifthenelse{#1 > 11}{
												\AddSpellslots{5}{1}
												\AddSpellslots{6}{1}
												\ifthenelse{#1 > 12}{
													\AddSpellslots{7}{1}
													\AddSpellslots{4}{1}
													\AddSpellslots{2}{1}
													\ifthenelse{#1 > 13}{
														\AddSpellslots{6}{1}
														\AddSpellslots{7}{1}
														\ifthenelse{#1 > 14}{
															\AddSpellslots{8}{1}
															\AddSpellslots{5}{1}
															\AddSpellslots{3}{1}
															\ifthenelse{#1 > 15}{
																\AddSpellslots{7}{1}
																\AddSpellslots{8}{1}
																\ifthenelse{#1 > 16}{
																	\AddSpellslots{9}{1}
																	\AddSpellslots{6}{1}
																	\AddSpellslots{4}{1}
																	\ifthenelse{#1 > 17}{
																		\AddSpellslots{8}{1}
																		\AddSpellslots{9}{1}
																		\ifthenelse{#1 > 18}{
																			\AddSpellslots{7}{1}
																			\AddSpellslots{9}{1}
																			\AddSpellslots{5}{1}
																			\ifthenelse{#1 > 19}{
																				\AddSpellslots{8}{1}
																				\AddSpellslots{9}{1}
																			}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}
}
\newcommand{\AddSpontaneousPrimarySpellcasting}[1]{
	\AddSpellslots{0}{5}
	\AddSpellslots{1}{3}
	\ifthenelse{#1 > 1}{
		\AddSpellslots{0}{1}
		\AddSpellslots{1}{1}
		\ifthenelse{#1 > 2}{
			\AddSpellslots{1}{1}
			\ifthenelse{#1 > 3}{
				\AddSpellslots{1}{1}
				\AddSpellslots{2}{3}
				\ifthenelse{#1 > 4}{
					\AddSpellslots{2}{1}
					\ifthenelse{#1 > 5}{
						\AddSpellslots{2}{1}
						\AddSpellslots{3}{3}
						\ifthenelse{#1 > 6}{
							\AddSpellslots{2}{1}
							\AddSpellslots{3}{1}
							\ifthenelse{#1 > 7}{
								\AddSpellslots{3}{1}
								\AddSpellslots{4}{3}
								\ifthenelse{#1 > 8}{
									\AddSpellslots{3}{1}
									\AddSpellslots{4}{1}
									\ifthenelse{#1 > 9}{
										\AddSpellslots{4}{1}
										\AddSpellslots{5}{3}	
										\ifthenelse{#1 > 10}{
											\AddSpellslots{4}{1}
											\AddSpellslots{5}{1}
											\ifthenelse{#1 > 11}{
												\AddSpellslots{5}{1}
												\AddSpellslots{6}{3}
												\ifthenelse{#1 > 12}{
													\AddSpellslots{5}{1}
													\AddSpellslots{6}{1}
													\ifthenelse{#1 > 13}{
														\AddSpellslots{6}{1}
														\AddSpellslots{7}{3}
														\ifthenelse{#1 > 14}{
															\AddSpellslots{6}{1}
															\AddSpellslots{7}{1}
															\ifthenelse{#1 > 15}{
																\AddSpellslots{7}{1}
																\AddSpellslots{8}{3}
																\ifthenelse{#1 > 16}{
																	\AddSpellslots{7}{1}
																	\AddSpellslots{8}{1}
																	\ifthenelse{#1 > 17}{
																		\AddSpellslots{8}{1}
																		\AddSpellslots{9}{3}
																		\ifthenelse{#1 > 18}{
																			\AddSpellslots{8}{1}
																			\AddSpellslots{9}{1}
																			\ifthenelse{#1 > 19}{
																				\AddSpellslots{9}{2}
																			}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}
	
}
\newcommand{\AddTwoThirdsSpellcasing}[1]{
	\AddSpellslots{0}{2}
	\AddSpellsKnown{0}{4}
	\ifthenelse{#1 > 1}{
		\AddSpellslots{0}{1}
		\AddSpellsKnown{0}{1}
		\AddSpellsKnown{1}{2}
		\ifthenelse{#1 > 2}{
			\AddSpellslots{1}{1}
			\AddSpellsKnown{0}{1}
			\AddSpellsKnown{1}{1}
			\ifthenelse{#1 > 3}{
				\AddSpellslots{1}{1}
				\AddSpellsKnown{2}{2}
				\ifthenelse{#1 > 4}{
					\AddSpellslots{1}{1}
					\AddSpellslots{2}{1}
					\AddSpellsKnown{1}{1}
					\AddSpellsKnown{2}{1}
					\ifthenelse{#1 > 5}{
						\AddSpellslots{2}{1}
						\ifthenelse{#1 > 6}{
							\AddSpellsKnown{2}{1}
							\AddSpellsKnown{3}{2}
							\ifthenelse{#1 > 7}{
								\AddSpellslots{2}{1}
								\AddSpellslots{3}{1}
								\AddSpellsKnown{3}{1}
								\ifthenelse{#1 > 8}{
									\AddSpellslots{3}{1}
									\ifthenelse{#1 > 9}{
										\AddSpellsKnown{3}{1}
										\AddSpellsKnown{4}{2}
										\ifthenelse{#1 > 10}{
											\AddSpellslots{3}{1}
											\AddSpellslots{4}{1}
											\AddSpellsKnown{4}{1}
											\ifthenelse{#1 > 11}{
												\AddSpellslots{4}{1}
												\ifthenelse{#1 > 12}{
													\AddSpellsKnown{4}{1}
													\AddSpellsKnown{5}{2}
													\ifthenelse{#1 > 13}{
														\AddSpellslots{0}{1}
														\AddSpellslots{4}{1}
														\AddSpellslots{5}{1}
														\AddSpellsKnown{5}{1}
														\ifthenelse{#1 > 14}{
															\AddSpellslots{1}{1}
															\AddSpellslots{5}{1}
															\ifthenelse{#1 > 15}{
																\AddSpellslots{2}{1}
																\AddSpellsKnown{1}{1}
																\AddSpellsKnown{5}{1}
																\AddSpellsKnown{6}{2}
																\ifthenelse{#1 > 16}{
																	\AddSpellslots{3}{1}
																	\AddSpellslots{5}{1}
																	\AddSpellslots{6}{1}
																	\AddSpellsKnown{2}{1}
																	\AddSpellsKnown{6}{1}
																	\ifthenelse{#1 > 17}{
																		\AddSpellslots{4}{1}
																		\AddSpellslots{6}{1}
																		\AddSpellsKnown{3}{1}
																		\ifthenelse{#1 > 18}{
																			\AddSpellslots{5}{1}
																			\AddSpellslots{6}{1}
																			\AddSpellsKnown{4}{1}
																			\AddSpellsKnown{6}{1}
																			\ifthenelse{#1 > 19}{
																				\AddSpellslots{6}{1}
																				\AddSpellsKnown{5}{1}
																			}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}
}
\newcommand{\AddHalfSpellcasting}[1]{
	\ifthenelse{#1 > 5}{
		\AddSpellslots{1}{1}
		\ifthenelse{#1 > 9}{
			\AddSpellslots{2}{1}
			\ifthenelse{#1 > 11}{
				\AddSpellslots{3}{1}
				\ifthenelse{#1 > 13}{
					\AddSpellslots{1}{1}
					\ifthenelse{#1 > 14}{
						\AddSpellslots{4}{1}
						\ifthenelse{#1 > 15}{
							\AddSpellslots{2}{1}
							\ifthenelse{#1 > 16}{
								\AddSpellslots{3}{1}
								\ifthenelse{#1 > 17}{
									\AddSpellslots{1}{1}
									\ifthenelse{#1 > 18}{
										\AddSpellslots{2}{1}
										\AddSpellslots{3}{1}
										\AddSpellslots{4}{1}
										\ifthenelse{#1 > 19}{
											\AddSpellslots{4}{1}
										}{}}{}}{}}{}}{}}{}}{}}{}}{}}{}
}